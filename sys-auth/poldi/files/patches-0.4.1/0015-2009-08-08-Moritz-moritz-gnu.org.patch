From db48924e7e5719295628e0ae3a3ef214cab517b7 Mon Sep 17 00:00:00 2001
From: Moritz Schulte <mo@g10code.com>
Date: Sat, 8 Aug 2009 18:11:18 +0000
Subject: [PATCH 15/52] 2009-08-08  Moritz  <moritz@gnu.org>

	* THANKS: Updated.
	* configure.ac (AC_CONFIG_FILES): Added src/util/configure-stamp.

2009-08-08  Moritz  <moritz@gnu.org>

	* de.po: Updated translation.

2009-08-08  Moritz  <moritz@gnu.org>

	* configure-stamp.in: New file.
	* Makefile.am (defs.h): Added dependency on configure-stamp.
	(EXTRA_DIST, CLEANFILES): Added configure-stamp.

2009-08-08  Moritz  <moritz@gnu.org>

	* getpin-cb.c (getpin_cb): Fixed fallback prompts. Thanks to Lionel.
	* ctx.h (struct poldi_ctx_s): New member: scdaemon_options.
---
 ChangeLog                        |   2 +
 THANKS                           |   1 +
 configure.ac                     |   3 +-
 po/ChangeLog                     |   5 ++
 po/LINGUAS                       |   3 +
 po/de.po                         | 127 ++++++++++++++++++-------------
 po/poldi.pot                     |   6 +-
 src/pam/auth-support/ChangeLog   |   1 +
 src/pam/auth-support/getpin-cb.c |   6 +-
 src/util/ChangeLog               |   6 ++
 src/util/Makefile.am             |   8 +-
 src/util/configure-stamp.in      |   1 +
 12 files changed, 105 insertions(+), 64 deletions(-)
 create mode 100644 po/LINGUAS
 create mode 100644 src/util/configure-stamp.in

diff --git a/ChangeLog b/ChangeLog
index 926a6db..7c032c8 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,5 +1,7 @@
 2009-08-08  Moritz  <moritz@gnu.org>
 
+	* THANKS: Updated.
+	* configure.ac (AC_CONFIG_FILES): Added src/util/configure-stamp.
 	* AUTHORS (Homepage): Fixed.
 
 2009-08-03  Werner Koch  <wk@g10code.com>
diff --git a/THANKS b/THANKS
index b5248b7..b2e27c9 100644
--- a/THANKS
+++ b/THANKS
@@ -6,3 +6,4 @@ patches or testing:
 	Stefano Maffulli
 	Gordian Klein
 	Peter Lewis
+	Lionel Elie Mamane
diff --git a/configure.ac b/configure.ac
index e118327..c901520 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1,5 +1,5 @@
 # configure.ac - Configure script for Poldi
-# Copyright (C) 2004, 2005, 2007, 2008 g10 Code GmbH
+# Copyright (C) 2004, 2005, 2007, 2008, 2009 g10 Code GmbH
 # 
 # This file is part of Poldi.
 #
@@ -236,6 +236,7 @@ AC_CONFIG_FILES([Makefile
 		 src/Makefile
 		 src/assuan/Makefile
 		 src/util/Makefile
+		 src/util/configure-stamp
 		 src/scd/Makefile
 		 src/ctrl/Makefile
 		 src/pam/Makefile
diff --git a/po/ChangeLog b/po/ChangeLog
index 8f30946..26db663 100644
--- a/po/ChangeLog
+++ b/po/ChangeLog
@@ -1,3 +1,8 @@
+2009-08-08  Moritz  <moritz@gnu.org>
+
+	* de.po: Updated translation.
+	* LINGUAS: New file.
+
 2008-08-08  Moritz  <moritz@gnu.org>
 
 	* de.po: Improved.
diff --git a/po/LINGUAS b/po/LINGUAS
new file mode 100644
index 0000000..137b904
--- /dev/null
+++ b/po/LINGUAS
@@ -0,0 +1,3 @@
+# Set of available languages.
+
+de
diff --git a/po/de.po b/po/de.po
index eff38ef..20f3e8e 100644
--- a/po/de.po
+++ b/po/de.po
@@ -7,8 +7,8 @@ msgid ""
 msgstr ""
 "Project-Id-Version: poldi 0.4-cvs\n"
 "Report-Msgid-Bugs-To: gnupg-devel@gnupg.org\n"
-"POT-Creation-Date: 2008-08-08 01:50+0200\n"
-"PO-Revision-Date: 2008-08-08 01:51+0200\n"
+"POT-Creation-Date: 2009-08-08 18:44+0200\n"
+"PO-Revision-Date: 2009-08-08 18:51+0200\n"
 "Last-Translator: Moritz Schulte <moritz@g10code.com>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
 "MIME-Version: 1.0\n"
@@ -69,28 +69,30 @@ msgid "Please enter username: "
 msgstr "Bitte Benutzername eingeben: "
 
 #: src/pam/auth-method-localdb/auth-localdb.c:121
+#: src/pam/auth-method-localdb/auth-localdb.c:124
 #, c-format
 msgid "Trying authentication as user `%s'..."
 msgstr "Versuche Authentifizierung als Benutzer '%s'..."
 
-#: src/pam/auth-method-localdb/auth-localdb.c:129
+#: src/pam/auth-method-localdb/auth-localdb.c:133
+#: src/pam/auth-method-localdb/auth-localdb.c:136
 #, c-format
 msgid "Serial number %s is not associated with user %s"
 msgstr "Seriennummer %s ist nicht assoziiert mit Benutzer %s"
 
-#: src/pam/auth-method-localdb/auth-localdb.c:145
+#: src/pam/auth-method-localdb/auth-localdb.c:152
 #: src/pam/auth-method-x509/auth-x509.c:553
 #, c-format
 msgid "failed to generate challenge: %s"
 msgstr "Generierung der Challenge fehlgeschlagen: %s"
 
-#: src/pam/auth-method-localdb/auth-localdb.c:157
+#: src/pam/auth-method-localdb/auth-localdb.c:164
 #: src/pam/auth-method-x509/auth-x509.c:565
 #, c-format
 msgid "failed to retrieve challenge signature from card: %s"
 msgstr "konnte Signatur der Challenge nicht von der Karte empfangen: %s"
 
-#: src/pam/auth-method-localdb/auth-localdb.c:167
+#: src/pam/auth-method-localdb/auth-localdb.c:174
 msgid "failed to verify challenge"
 msgstr "Verifizierung der Challenge fehlgeschlagen"
 
@@ -132,13 +134,12 @@ msgstr "getpin-Callback mit nicht unterstützten Flags in '%s' aufgerufen\n"
 
 #: src/pam/auth-support/getpin-cb.c:224
 #, c-format
-msgid "frob_info_msg failed for info msg of size of size %u\n"
-msgstr "frob_info_msg() fehlgeschlagen für eine Nachricht der Länge %u\n"
+msgid "frob_info_msg failed for info msg of size %u\n"
+msgstr "frob_info_msg fehlgeschlagen für eine Nachricht der Länge %u\n"
 
 #: src/pam/auth-support/getpin-cb.c:238 src/pam/auth-support/getpin-cb.c:257
-#, fuzzy
-msgid "||Please enter the PIN"
-msgstr "Bitte Benutzername eingeben: "
+msgid "Please enter the PIN:"
+msgstr "Bitte PIN eingeben:"
 
 #: src/pam/auth-method-x509/dirmngr.c:153
 #, c-format
@@ -218,96 +219,108 @@ msgstr "fehlgeschlagen: %s"
 msgid "success"
 msgstr "Erfolg"
 
-#: src/pam/pam_poldi.c:135 src/pam/pam_poldi.c:148 src/pam/pam_poldi.c:162
+#: src/pam/pam_poldi.c:142 src/pam/pam_poldi.c:155 src/pam/pam_poldi.c:169
 #: src/scd/scd.c:124
 #, c-format
 msgid "failed to duplicate %s: %s"
 msgstr "Konnte %s nicht duplizieren: %s"
 
-#: src/pam/pam_poldi.c:177
+#: src/pam/pam_poldi.c:184
 #, c-format
 msgid "unknown authentication method '%s'"
 msgstr "unbekannte Authentifikationsmethode '%s'"
 
-#: src/pam/pam_poldi.c:338
+#: src/pam/pam_poldi.c:312
+#, c-format
+msgid "asprintf() failed in modify_environment_putenv(): %s"
+msgstr "asprintf() in modify_environment_putenv() fehlgeschlagen: %s"
+
+#: src/pam/pam_poldi.c:321
 #, c-format
-msgid "failed to parse configuration file: %s"
-msgstr "Konnte Konfigurationsdatei nicht lesen: %s"
+msgid "pam_putenv() failed in modify_environment_putenv(): %s"
+msgstr "pam_putenv() in modify_environment_putenv() fehlgeschlagen: %s"
 
-#: src/pam/pam_poldi.c:350
+#: src/pam/pam_poldi.c:406
+#, c-format
+msgid "failed to parse configuration file '%s': %s"
+msgstr "Lesen der Konfigurationsdatei '%s' fehlgeschlagen: %s"
+
+#: src/pam/pam_poldi.c:419
 #, c-format
 msgid "failed to parse PAM argument vector: %s"
 msgstr "Auswertung des PAM Argumentvektors fehlgeschlagen: %s"
 
-#: src/pam/pam_poldi.c:379
+#: src/pam/pam_poldi.c:448
 msgid "no authentication method specified"
 msgstr "Keine Authentifikationsmethode spezifiziert"
 
-#: src/pam/pam_poldi.c:393
+#: src/pam/pam_poldi.c:462
 #, c-format
 msgid "using authentication method `%s'"
 msgstr "benutze Authentifikationsmethode '%s'"
 
-#: src/pam/pam_poldi.c:397
-#, c-format
-msgid "using system scdaemon; socket is '%s'"
-msgstr "benutze System-Scdaaemon; Socket ist '%s'"
-
-#: src/pam/pam_poldi.c:409
+#: src/pam/pam_poldi.c:474
 #, c-format
 msgid "failed to initialize authentication method %i: %s"
 msgstr "Initialisierung der Authentifikationsmethode %i fehlgeschlagen: %s"
 
-#: src/pam/pam_poldi.c:423
+#: src/pam/pam_poldi.c:488
 #, c-format
 msgid ""
 "failed to initialize parsing of configuration file for authentication method "
 "%s: %s"
-msgstr ""
-"konnte Auswertung der Konfigurationsdatei für die Authentifikationsmethode %"
-"s nicht beginnen: %s"
+msgstr "konnte Auswertung der Konfigurationsdatei für die Authentifikationsmethode %s nicht beginnen: %s"
 
-#: src/pam/pam_poldi.c:444
+#: src/pam/pam_poldi.c:509
 #, c-format
 msgid "failed to parse configuration for authentication method %i: %s"
 msgstr ""
 "konnte Konfigurationsdatei für die Authentifikationsmethode %i nicht lesen: %"
 "s"
 
-#: src/pam/pam_poldi.c:463
+#: src/pam/pam_poldi.c:528
 msgid "failed to retrieve PAM conversation structure"
 msgstr "konnte PAM conversation-structure nicht empfangen"
 
-#: src/pam/pam_poldi.c:481
+#: src/pam/pam_poldi.c:546
 #, c-format
 msgid "failed to retrieve username from PAM: %s"
 msgstr "konnte Benutzername nicht von PAM empfangen: %s"
 
-#: src/pam/pam_poldi.c:502
+#: src/pam/pam_poldi.c:570
 #, c-format
 msgid "Waiting for card for user `%s'..."
 msgstr "Warte auf Karte für Benutzer '%s'..."
 
-#: src/pam/pam_poldi.c:504
+#: src/pam/pam_poldi.c:572
+#, c-format
+msgid "Insert authentication card for user `%s'"
+msgstr "Bitte Authentifikationskarte für Benutzer '%s' einlegen"
+
+#: src/pam/pam_poldi.c:577
 msgid "Waiting for card..."
 msgstr "Warte auf Karte..."
 
-#: src/pam/pam_poldi.c:510
+#: src/pam/pam_poldi.c:579
+msgid "Insert authentication card"
+msgstr "Bitte Authentifikationsschlüssel einlegen"
+
+#: src/pam/pam_poldi.c:586
 #, c-format
 msgid "failed to wait for card insertion: %s"
 msgstr "Warten auf Karte fehlgeschlagen: %s"
 
-#: src/pam/pam_poldi.c:523
+#: src/pam/pam_poldi.c:599
 #, c-format
 msgid "connected to card; serial number is: %s"
 msgstr "Verbunden zur Karte; Seriennummer ist: '%s'"
 
-#: src/pam/pam_poldi.c:561
+#: src/pam/pam_poldi.c:637
 #, c-format
 msgid "authentication failed: %s"
 msgstr "Authentifikation fehlgeschlagen: %s"
 
-#: src/pam/pam_poldi.c:563
+#: src/pam/pam_poldi.c:641
 msgid "authentication succeeded"
 msgstr "Authentifikation erfolgreich"
 
@@ -320,66 +333,74 @@ msgstr "syntaktisch ungültige GPG_AGENT_INFO Umgebungsvariable"
 msgid "agent protocol version %d is not supported"
 msgstr "Agent-Protokoll Version %d ist nicht unterstützt"
 
-#: src/scd/scd.c:197 src/scd/scd.c:925
+#: src/scd/scd.c:197 src/scd/scd.c:941
 #, c-format
 msgid "warning: can't store getinfo data: %s"
 msgstr "Warnung: konnte GETINFO Daten nicht speichern: %s"
 
-#: src/scd/scd.c:294
+#: src/scd/scd.c:295
 #, c-format
 msgid "connected to system scdaemon through socket '%s'"
 msgstr "über den Socket '%s' zu System Scdaemon verbunden"
 
-#: src/scd/scd.c:314
+#: src/scd/scd.c:315
 #, c-format
 msgid "got scdaemon socket name from gpg-agent, connected to socket '%s'"
 msgstr ""
 "Scdaemon Socket Namen über GPG-Agent empfangen, verbunden mit Socket '%s'"
 
-#: src/scd/scd.c:335
+#: src/scd/scd.c:336
 msgid "no running scdaemon - starting one"
 msgstr "Kein aktiver Scdaemon - starte einen"
 
-#: src/scd/scd.c:341
+#: src/scd/scd.c:342
 #, c-format
 msgid "error flushing pending output: %s"
 msgstr "konnte wartende Ausgabe nicht schreiben: %s"
 
-#: src/scd/scd.c:374
+#: src/scd/scd.c:385
 #, c-format
 msgid "spawned a new scdaemon (path: '%s')"
 msgstr "neuer Scdaemon gestartet (Pfad: '%s')"
 
-#: src/scd/scd.c:381
+#: src/scd/scd.c:392
 #, c-format
 msgid "could not connect to any scdaemon: %s"
 msgstr "Verbinden zu Scdaemon fehlgeschlagen: %s"
 
-#: src/scd/scd.c:404
+#: src/scd/scd.c:415
 msgid "connection to scdaemon established"
 msgstr "Verbindung zu Scdaemon hergestellt"
 
-#: src/util/simpleparse.c:137
+#: src/util/simpleparse.c:149
 #, c-format
 msgid "Please report bugs to <%s>.\n"
 msgstr "Bitte sende Fehlerberichte an <%s>.\n"
 
-#: src/util/simpleparse.c:296
+#: src/util/simpleparse.c:308 src/util/simpleparse.c:597
 #, c-format
-msgid "invalid option '%s'"
-msgstr "ungültige Option '%s'"
+msgid "unknown option '%s'"
+msgstr "unbekannte Option '%s'"
 
-#: src/util/simpleparse.c:309 src/util/simpleparse.c:323
-#: src/util/simpleparse.c:340 src/util/simpleparse.c:366
+#: src/util/simpleparse.c:321 src/util/simpleparse.c:335
+#: src/util/simpleparse.c:352 src/util/simpleparse.c:378
 #, c-format
 msgid "parse-callback returned error '%s' for argument '%s'"
 msgstr "parse-Callback hat Fehler '%s' für das Argument '%s' zurückgegeben"
 
-#: src/util/simpleparse.c:353
+#: src/util/simpleparse.c:365 src/util/simpleparse.c:619
 #, c-format
 msgid "missing required argument for '%s'"
 msgstr "fehlendes notwendiges Argument für '%s'"
 
+#: src/util/simpleparse.c:608 src/util/simpleparse.c:628
+#, c-format
+msgid "too many arguments specified for option '%s'"
+msgstr "zu viele Argumente für Options '%s' angegeben"
+
+#~ msgid "using system scdaemon; socket is '%s'"
+#~ msgstr "benutze System-Scdaaemon; Socket ist '%s'"
+
 #~ msgid "Please enter PIN on keypad"
 #~ msgstr "Bitte PIN auf der Tastatur des Kartenlesers eingeben"
 
diff --git a/po/poldi.pot b/po/poldi.pot
index f6ffed1..d257a9b 100644
--- a/po/poldi.pot
+++ b/po/poldi.pot
@@ -8,7 +8,7 @@ msgid ""
 msgstr ""
 "Project-Id-Version: poldi 0.4.2-cvs\n"
 "Report-Msgid-Bugs-To: gnupg-devel@gnupg.org\n"
-"POT-Creation-Date: 2009-08-08 15:48+0200\n"
+"POT-Creation-Date: 2009-08-08 18:44+0200\n"
 "PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
 "Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
 "Language-Team: LANGUAGE <LL@li.org>\n"
@@ -131,11 +131,11 @@ msgstr ""
 
 #: src/pam/auth-support/getpin-cb.c:224
 #, c-format
-msgid "frob_info_msg failed for info msg of size of size %u\n"
+msgid "frob_info_msg failed for info msg of size %u\n"
 msgstr ""
 
 #: src/pam/auth-support/getpin-cb.c:238 src/pam/auth-support/getpin-cb.c:257
-msgid "||Please enter the PIN"
+msgid "Please enter the PIN:"
 msgstr ""
 
 #: src/pam/auth-method-x509/dirmngr.c:153
diff --git a/src/pam/auth-support/ChangeLog b/src/pam/auth-support/ChangeLog
index fceb260..0dc9f75 100644
--- a/src/pam/auth-support/ChangeLog
+++ b/src/pam/auth-support/ChangeLog
@@ -1,5 +1,6 @@
 2009-08-08  Moritz  <moritz@gnu.org>
 
+	* getpin-cb.c (getpin_cb): Fixed fallback prompts. Thanks to Lionel.
 	* ctx.h (struct poldi_ctx_s): New member: scdaemon_options.
 
 2009-05-16  Moritz  <moritz@gnu.org>
diff --git a/src/pam/auth-support/getpin-cb.c b/src/pam/auth-support/getpin-cb.c
index 15aa6e7..10acbe7 100644
--- a/src/pam/auth-support/getpin-cb.c
+++ b/src/pam/auth-support/getpin-cb.c
@@ -221,7 +221,7 @@ getpin_cb (void *opaque, const char *info, char *buf, size_t maxbuf)
       if (err)
 	{
 	  log_msg_error (ctx->loghandle,
-			 _("frob_info_msg failed for info msg of size of size %u\n"),
+			 _("frob_info_msg failed for info msg of size %u\n"),
 			 (unsigned int) strlen (info));
 	  goto out;
 	}
@@ -235,7 +235,7 @@ getpin_cb (void *opaque, const char *info, char *buf, size_t maxbuf)
 	err = query_user (ctx, info_frobbed, buf, maxbuf);
       else
 	/* Use string which is more user friendly. */
-	err = query_user (ctx, _("||Please enter the PIN"), buf, maxbuf);
+	err = query_user (ctx, _("Please enter the PIN:"), buf, maxbuf);
     }
   else
     {
@@ -254,7 +254,7 @@ getpin_cb (void *opaque, const char *info, char *buf, size_t maxbuf)
 	  if (info_frobbed)
 	    err = keypad_mode_enter (ctx, info_frobbed);
 	  else
-	    err = keypad_mode_enter (ctx, _("||Please enter the PIN"));
+	    err = keypad_mode_enter (ctx, _("Please enter the PIN:"));
 	}
       else
         err = gpg_error (GPG_ERR_INV_VALUE); /* FIXME: must signal
diff --git a/src/util/ChangeLog b/src/util/ChangeLog
index 1c3d719..b4db922 100644
--- a/src/util/ChangeLog
+++ b/src/util/ChangeLog
@@ -1,3 +1,9 @@
+2009-08-08  Moritz  <moritz@gnu.org>
+
+	* configure-stamp.in: New file.
+	* Makefile.am (defs.h): Added dependency on configure-stamp.
+	(EXTRA_DIST, CLEANFILES): Added configure-stamp.
+
 2008-12-22  Moritz  <moritz@gnu.org>
 
 	* simpleparse.c (internal_process_tokens): Added error message in
diff --git a/src/util/Makefile.am b/src/util/Makefile.am
index 3e9c5fa..72cf95e 100644
--- a/src/util/Makefile.am
+++ b/src/util/Makefile.am
@@ -1,4 +1,4 @@
-# Copyright (C) 2004, 2007, 2008 g10 Code GmbH
+# Copyright (C) 2004, 2007, 2008, 2009 g10 Code GmbH
 #
 # This file is part of Poldi.
 #
@@ -52,10 +52,10 @@ generate = \
 	sed \
          -e 's,[@]POLDI_CONF_DIRECTORY[@],$(POLDI_CONF_DIRECTORY),g'
 
-defs.h: defs.h.in
+defs.h: defs.h.in configure-stamp
 	$(generate) < $< > $@
 
 EXTRA_DIST = \
-	defs.h.in
+	defs.h.in configure-stamp.in
 
-CLEANFILES = $(BUILT_SOURCES)
+CLEANFILES = $(BUILT_SOURCES) configure-stamp
diff --git a/src/util/configure-stamp.in b/src/util/configure-stamp.in
new file mode 100644
index 0000000..8551eac
--- /dev/null
+++ b/src/util/configure-stamp.in
@@ -0,0 +1 @@
+/* configure-stamp, only used for dependency tracking. */
-- 
2.17.0

